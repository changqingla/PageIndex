# 日报：PDF 文档树处理流程简介

**PageIndex PDF 文档树处理流程**：上传 PDF 后，系统会将其转成一份带页码的文档树索引（JSON），供后续“树搜索”检索使用，整体分为八步。

**一、解析与目录检测**  
先逐页提取 PDF 文本并估算每页 token 数，形成页表；再在前若干页（默认 20 页）用大模型逐页判断是否为目录页，并判断目录是否自带页码，从而区分三种情况：目录带页码、目录不带页码、无目录。

**二、章节列表与起始页**（唯一因有无目录而不同的环节）  
系统需得到“层级编号 + 标题 + 起始物理页”的扁平列表。若目录带页码，则解析目录并利用正文前几页做“目录页码 ↔ 物理页”对齐、换算偏移；若目录不带页码，则保留目录标题，分段扫正文由模型标出每章首次出现的物理页；若无目录，则分段读正文，首段生成初始目录、后续段延续并补充新章节及起始页。得到列表后做抽样校验，必要时修正或降级重算。

**三、起止页与建树**（有目录 / 无目录此后完全一致）  
必要时插入“前言”节点；并发询问模型每章是否从标注的起始页页首开始，据此为每章计算结束页。再按层级编号（如 1、1.1、1.2）推导父子关系，将扁平列表建为树。对页数或 token 超限的“大节点”，在其起止页范围内重新走一遍无目录式分段生成子结构，递归直到不超限。

**四、编号与输出**  
对树做深度优先遍历分配唯一 node_id；可选地为每个节点写入对应页正文、并用模型生成摘要。最终将文档名与整棵树写入 JSON，检索时在树上做推理定位，按起止页取正文作答。

---

*（约 500 字，基于《PageIndex 算法技术报告》3.1.1 节整理）*
